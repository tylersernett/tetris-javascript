(()=>{"use strict";var e={d:(n,t)=>{for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};function n(e,n){return(e%n+n)%n}function t(e){return e>=re}function r(e){return e>oe-1||e<0}function o(e,n){return 0!==te[n][e]}function i(){const{rotations:e,rotationIndex:n,gridX:t,gridY:r,image:i}=ke,c=e[n];let s=!1;c.forEach((e=>{const n=e.x+t,c=e.y+r;ne[c][n]=1;const{x:l,y:a}=ee[c][n];D.drawImage(i,l,a),o(n,c)&&(s=!0)})),s&&Ee()}function c(){let e=ce[0][0].x,n=ce[0][0].y;D.fillStyle="white",D.fillRect(e,n,4*(1+Q+1),3*(1+Q+1)),Se.rotations[0].forEach((e=>{const n=e.x,t=e.y,{x:r,y:o}=ce[t][n];D.drawImage(Se.image,r,o)}))}function s(){let e=.5;ke.rotations[ke.rotationIndex].forEach((n=>{let t=n.x+ke.gridX,r=n.y+ke.gridY;ne[r][t]=0;let o=ee[r][t].x,i=ee[r][t].y;D.fillStyle=pe,D.fillRect(o-e,i-e,Q+e+2,Q+e+2)}))}function l(){for(let e=0;e<re;e++)for(let n=0;n<oe;n++){let t=ee[e][n].x,r=ee[e][n].y,o=0!==te[e][n]?te[e][n]:void 0;o&&D.drawImage(o,t,r)}}function a(){fe.show=!fe.show,fe.show?d(!1):h.style.visibility="hidden"}async function d(e){fe.show=!0;const n=await u(),t=n.map((e=>`<li>${e.name}: ${e.score}</li>`)).join("");y.innerHTML=`<ol>${t}</ol>`,h.style.visibility="visible",e&&(n.length<5||fe.score>n[4]?.score)&&(f.style.visibility="visible")}async function u(){try{const e=await fetch("https://tetris-javascript.onrender.com/highscores");return await e.json()}catch(e){return console.error("Error getting scores:",e),[]}}e.d({},{Um:()=>pe,jy:()=>Q,s1:()=>Xe,x9:()=>ee,Ok:()=>Ae,Xl:()=>D,curTetromino:()=>ke,y1:()=>he,bA:()=>xe,Y1:()=>re,FD:()=>oe,Dg:()=>ne,e2:()=>me,Tx:()=>Ee,pe:()=>y,y3:()=>h,Cb:()=>f,Zm:()=>p,_O:()=>Se,St:()=>ce,Pk:()=>fe,Y6:()=>m,Lv:()=>Le,xy:()=>te});let w,h,y,f,m,g,p,v,b,k,S,x,I,q,E,L,A,Y,X,j,T,M,O,R,B,D,C,H,P={hspeed:0,vspeed:0,rspeed:0},z=6,$=2,J=-z,Z=-$;function F(e){me||("ArrowLeft"===e.key?P.hspeed=-1:"ArrowRight"===e.key?P.hspeed=1:"ArrowDown"===e.key?U():"x"===e.key?(P.rspeed=1,G(1)):"z"===e.key&&(P.rspeed=-1,G(-1)))}function N(e){"ArrowLeft"===e.key||"ArrowRight"===e.key?P.hspeed=0:"ArrowDown"===e.key?_():"x"!==e.key&&"z"!==e.key||(P.rspeed=0)}function U(){P.vspeed=1}function _(){P.vspeed=0,Le(!0)}function G(e){me||function(e){let i=ke.rotationIndex+e;return ke.rotations[n(i,ke.rotLength)].some((e=>{let n=e.x+ke.gridX,i=e.y+ke.gridY;return r(n)||t(i)||o(n,i)}))}(e)||(s(),ke.rotationIndex+=e,ke.rotationIndex=n(ke.rotationIndex,ke.rotLength),i())}function K(){me||function(e){const n=ke.rotations[ke.rotationIndex];return!!n.some((e=>{const n=e.x+ke.gridX,r=e.y+ke.gridY+1;return t(r)||o(n,r)}))&&(n.forEach((e=>{const n=e.x+ke.gridX,t=e.y+ke.gridY;te[t][n]=ke.image})),Xe(),Ae(),i(),!0)}()||(s(),ke.gridY++,i())}document.addEventListener("DOMContentLoaded",(()=>{w=document.querySelector("#my-canvas"),g=document.getElementById("game-over"),h=document.getElementById("highscore-outer"),y=document.getElementById("highscore-display"),f=document.getElementById("highscore-prompt"),v=document.querySelector("#highscore-button"),b=document.querySelector("#restart-button"),k=document.querySelector("#score-form"),m=document.querySelector("#score-form-submit"),p=document.querySelector("#name-submit"),S=document.getElementById("score"),x=document.getElementById("lines"),I=document.getElementById("level"),q=document.querySelector("#rot-ccw"),E=document.querySelector("#rot-cw"),L=document.querySelector("#move-left"),A=document.querySelector("#move-down"),Y=document.querySelector("#move-right"),X=document.querySelector("#block-t"),j=document.querySelector("#block-i"),T=document.querySelector("#block-j"),M=document.querySelector("#block-sq"),O=document.querySelector("#block-l"),R=document.querySelector("#block-s"),B=document.querySelector("#block-z"),document.addEventListener("keydown",F),document.addEventListener("keyup",N,!1),k.addEventListener("submit",(function(e){e.preventDefault(),async function(e){e.preventDefault(),m.disabled=!0;try{await fetch("https://tetris-javascript.onrender.com/add-score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:p.value,score:fe.score,lines:fe.lines,level:fe.level})}),f.style.visibility="hidden",d(!1)}catch(e){console.error("Error submitting score:",e)}}(e)})),v.onclick=a,b.onclick=be,q.onclick=()=>G(-1),E.onclick=()=>G(1),L.onpointerdown=()=>P.hspeed=-1,L.onpointerup=()=>P.hspeed=0,L.onpointerleave=()=>P.hspeed=0,A.onpointerdown=U,A.onpointerup=_,A.onpointerleave=_,Y.onpointerdown=()=>P.hspeed=1,Y.onpointerup=()=>P.hspeed=0,Y.onpointerleave=()=>P.hspeed=0,function(){D=w.getContext("2d"),C=4*V+oe*(Q+2*V),H=2*V+re*(Q+2*V);w.width=1*(C+5*(Q+2*V)),w.height=1*(5+H),D.scale(1,1)}(),function(){ee=Array.from({length:re},(()=>Array.from({length:oe},(()=>new W(0,0)))));let e=1+Q+1;for(let n=0;n<re;n++)for(let t=0;t<oe;t++)ee[n][t]=new W(3+e*t,1+e*n);for(let n=0;n<3;n++)for(let t=0;t<4;t++)ce[n][t]=new W(244+e*t,105+e*n)}(),ye.push(new ae([[new W(0,1),new W(1,1),new W(2,1),new W(1,2)],[new W(1,0),new W(0,1),new W(1,1),new W(1,2)],[new W(0,1),new W(1,1),new W(2,1),new W(1,0)],[new W(1,0),new W(2,1),new W(1,1),new W(1,2)]],X,"T")),ye.push(new ae([[new W(0,2),new W(1,2),new W(2,2),new W(3,2)],[new W(2,0),new W(2,1),new W(2,2),new W(2,3)]],j,"I")),ye.push(new ae([[new W(0,1),new W(1,1),new W(2,1),new W(2,2)],[new W(1,0),new W(0,2),new W(1,1),new W(1,2)],[new W(0,1),new W(1,1),new W(2,1),new W(0,0)],[new W(1,0),new W(2,0),new W(1,1),new W(1,2)]],T,"J")),ye.push(new ae([[new W(1,1),new W(2,1),new W(1,2),new W(2,2)]],M,"sq")),ye.push(new ae([[new W(0,1),new W(1,1),new W(2,1),new W(0,2)],[new W(1,0),new W(0,0),new W(1,1),new W(1,2)],[new W(0,1),new W(1,1),new W(2,1),new W(2,0)],[new W(1,0),new W(2,2),new W(1,1),new W(1,2)]],O,"L")),ye.push(new ae([[new W(1,1),new W(2,1),new W(0,2),new W(1,2)],[new W(1,1),new W(2,1),new W(1,0),new W(2,2)]],R,"S")),ye.push(new ae([[new W(0,1),new W(1,1),new W(1,2),new W(2,2)],[new W(2,0),new W(1,1),new W(1,2),new W(2,1)]],B,"Z")),be(),u()}));let Q=21,V=1;class W{constructor(e,n){this.x=e,this.y=n}}let ee,ne,te,re=20,oe=10;function ie(e){return new Array(re).fill(0).map((()=>new Array(oe).fill(0)))}const ce=Array.from({length:3},(()=>Array.from({length:4},(()=>new W(0,0)))));let se=4,le=0;class ae{constructor(e,n,t,r=0,o=se,i=le){this.rotations=e,this.image=n,this.name=t,this.rotationIndex=r,this.gridX=o,this.gridY=i}get rotLength(){return this.rotations?.length||0}getSecondArrayLength(){return this.rotations[0]?.length||0}}let de,ue,we,he,ye=[],fe={show:!1,score:0,level:1,lines:0},me=!1,ge=60,pe="#f8f8f8",ve="black";function be(){m.disabled=!1,fe={show:!1,score:0,level:1,lines:0},me=!1,je(),we=60,qe(),g.style.visibility="hidden",h.style.visibility="hidden",f.style.visibility="hidden",ne=ie(),te=ie(),D.clearRect(0,0,w.width,w.height),Ye(),Ae(),he=!0,clearInterval(de),de=setInterval(Ie,1e3/ge)}let ke,Se,xe=0;function Ie(){var e;me||(D.clearRect(0,0,w.width,w.height),D.fillStyle=pe,D.fillRect(0,0,C,H),D.strokeStyle=ve,D.strokeRect(.5,.5,C-1,H-1),0!==P.hspeed&&xe-J>=z&&(function(e){return 0!==e&&ke.rotations[ke.rotationIndex].some((n=>{const t=n.x+ke.gridX+e,i=n.y+ke.gridY;return r(t)||o(t,i)}))}(e=P.hspeed)||(s(),ke.gridX+=e,i()),J=xe),0!==P.vspeed&&xe-Z>=$&&he&&(K(),Z=xe),i(),l(),c(),xe++)}function qe(){let e;switch(fe.level){case 1:e=48;break;case 2:e=43;break;case 3:e=38;break;case 4:e=33;break;case 5:e=28;break;case 6:e=23;break;case 7:e=18;break;case 8:e=13;break;case 9:e=8;break;case 10:e=6;break;case 11:case 12:case 13:e=5;break;case 14:case 15:case 16:e=4;break;case 17:case 18:case 19:e=3;break;default:e=2}if(we!==e){we=e;let n=e/ge*1e3;clearInterval(ue),ue=setInterval((()=>{me||K()}),n)}}function Ee(){me=!0,g.style.visibility="visible",d(!0),clearInterval(de)}function Le(e){he=e}function Ae(){he=!1,ke=Se,ke.gridX=se,ke.gridY=le,ke.rotationIndex=0,Ye(),c()}function Ye(){let e=Math.floor(Math.random()*ye.length);Se=ye[e]}function Xe(){let e=0;for(let n=0;n<re;n++){let t=!1;if(te[n].every((e=>0!==e))&&(t=!0),t){e++;for(let e=0;e<oe;e++)te[n][e]=0,ne[n][e]=0;let t=te.splice(n,1);te.unshift(...t);let r=ne.splice(n,1);ne.unshift(...r)}}e>0&&(fe.score+=function(e){switch(e){case 1:return 40;case 2:return 100;case 3:return 300;case 4:return 1200;default:return 0}}(e)*fe.level,fe.lines+=e,fe.level=Math.floor(fe.lines/10)+1,qe(),je(),l())}function je(){S.innerHTML=fe.score.toString(),x.innerHTML=fe.lines.toString(),I.innerHTML=fe.level.toString()}})();